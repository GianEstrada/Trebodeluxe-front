<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test API Debug</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .output { background: #000; padding: 15px; border-radius: 8px; margin: 10px 0; }
        .error { color: #ff4444; }
        .success { color: #44ff44; }
        .info { color: #4444ff; }
        button { padding: 10px 20px; margin: 5px; background: #333; color: white; border: none; border-radius: 4px; cursor: pointer; }
        button:hover { background: #555; }
    </style>
</head>
<body>
    <h1>üîç Debug del API de Im√°genes Index</h1>
    
    <div>
        <button onclick="testLocalEndpoint()">Test Local: /api/index-images</button>
        <button onclick="testRemoteTemporary()">Test Remoto: site-settings</button>
        <button onclick="testRemotePublic()">Test Remoto: public</button>
        <button onclick="clearOutput()">Limpiar</button>
    </div>
    
    <div id="output" class="output">
        Presiona un bot√≥n para ejecutar tests...
    </div>

    <script>
        function log(message, type = 'info') {
            const output = document.getElementById('output');
            const timestamp = new Date().toLocaleTimeString();
            const className = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            output.innerHTML += `<div class="${className}">[${timestamp}] ${message}</div>`;
            output.scrollTop = output.scrollHeight;
        }
        
        function clearOutput() {
            document.getElementById('output').innerHTML = '';
        }
        
        async function testLocalEndpoint() {
            log('üß™ Probando endpoint local /api/index-images...', 'info');
            
            try {
                const response = await fetch('/api/index-images');
                log(`Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Respuesta exitosa`, 'success');
                    log(`üìä Success: ${data.success}`, 'info');
                    log(`üñºÔ∏è Total im√°genes: ${data.images?.length || 0}`, 'info');
                    
                    if (data.images) {
                        const bannerImages = data.images.filter(img => img.seccion === 'banner');
                        const activeImage = bannerImages.find(img => img.estado === 'activo');
                        
                        log(`üì± Im√°genes de banner: ${bannerImages.length}`, 'info');
                        
                        if (activeImage) {
                            log(`‚≠ê Imagen activa: "${activeImage.nombre}"`, 'success');
                            log(`üåê URL: ${activeImage.url}`, 'success');
                            log(`üìù Descripci√≥n: ${activeImage.descripcion || 'Sin descripci√≥n'}`, 'info');
                        } else {
                            log(`‚ö†Ô∏è No hay imagen activa en banner`, 'error');
                        }
                    }
                } else {
                    const text = await response.text();
                    log(`‚ùå Error response: ${text.substring(0, 200)}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
                
                if (error.message.includes('Failed to fetch')) {
                    log(`üí° Posible causa: Servidor no est√° corriendo`, 'info');
                } else if (error.message.includes('404')) {
                    log(`üí° Posible causa: Endpoint no encontrado`, 'info');
                }
            }
        }
        
        async function testRemoteTemporary() {
            log('üß™ Probando endpoint remoto temporal...', 'info');
            
            try {
                const url = 'https://trebodeluxe-backend.onrender.com/api/site-settings/index-images';
                log(`üì° URL: ${url}`, 'info');
                
                const response = await fetch(url);
                log(`Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Endpoint temporal funcionando`, 'success');
                    log(`üñºÔ∏è Total im√°genes: ${data.images?.length || 0}`, 'info');
                    
                    const bannerActive = data.images?.find(img => 
                        img.seccion === 'banner' && img.estado === 'activo'
                    );
                    if (bannerActive) {
                        log(`‚≠ê Banner activo: "${bannerActive.nombre}"`, 'success');
                    }
                } else {
                    const text = await response.text();
                    log(`‚ùå Error: ${text.substring(0, 200)}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        async function testRemotePublic() {
            log('üß™ Probando endpoint remoto p√∫blico...', 'info');
            
            try {
                const url = 'https://trebodeluxe-backend.onrender.com/api/public/index-images';
                log(`üì° URL: ${url}`, 'info');
                
                const response = await fetch(url);
                log(`Status: ${response.status}`, response.ok ? 'success' : 'error');
                
                if (response.ok) {
                    const data = await response.json();
                    log(`‚úÖ Endpoint p√∫blico funcionando`, 'success');
                    log(`üñºÔ∏è Total im√°genes: ${data.images?.length || 0}`, 'info');
                } else if (response.status === 404) {
                    log(`‚ö†Ô∏è Endpoint p√∫blico a√∫n no disponible (404)`, 'error');
                    log(`üí° Usar endpoint temporal mientras tanto`, 'info');
                } else {
                    const text = await response.text();
                    log(`‚ùå Error: ${text.substring(0, 200)}`, 'error');
                }
            } catch (error) {
                log(`‚ùå Error: ${error.message}`, 'error');
            }
        }
        
        // Test autom√°tico al cargar
        window.addEventListener('load', () => {
            log('üöÄ P√°gina cargada. Ejecutando tests autom√°ticos...', 'info');
            setTimeout(testLocalEndpoint, 1000);
        });
    </script>
</body>
</html>
