<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Trebodeluxe - Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .login-form, .admin-panel {
            border: 1px solid #ccc;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
        }
        .hidden {
            display: none;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        input {
            width: 100%;
            padding: 8px;
            margin: 5px 0;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .error {
            color: red;
            margin: 10px 0;
        }
        .success {
            color: green;
            margin: 10px 0;
        }
        .product-card {
            border: 1px solid #eee;
            padding: 15px;
            margin: 10px 0;
            border-radius: 6px;
            background: #f9f9f9;
        }
    </style>
</head>
<body>
    <h1>Admin Panel - Trebodeluxe</h1>
    
    <div id="loginForm" class="login-form">
        <h2>Iniciar Sesión</h2>
        <input type="text" id="usuario" placeholder="Usuario" value="admin">
        <input type="password" id="contrasena" placeholder="Contraseña" value="admin123">
        <button onclick="login()">Ingresar</button>
        <div id="loginError" class="error hidden"></div>
    </div>

    <div id="adminPanel" class="admin-panel hidden">
        <h2>Panel de Administración</h2>
        <div id="userInfo"></div>
        
        <h3>Acciones</h3>
        <button onclick="loadProducts()">Cargar Productos</button>
        <button onclick="loadSizes()">Cargar Tallas</button>
        <button onclick="logout()">Cerrar Sesión</button>
        
        <div id="results"></div>
    </div>

    <script>
        const API_URL = 'http://localhost:5000/api';
        let userToken = null;
        let currentUser = null;

        async function login() {
            const usuario = document.getElementById('usuario').value;
            const contrasena = document.getElementById('contrasena').value;
            
            try {
                const response = await fetch(`${API_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ usuario, contrasena })
                });

                const result = await response.json();
                
                if (result.success) {
                    userToken = result.token;
                    currentUser = result.user;
                    
                    document.getElementById('loginForm').classList.add('hidden');
                    document.getElementById('adminPanel').classList.remove('hidden');
                    document.getElementById('userInfo').innerHTML = `
                        <p><strong>Usuario:</strong> ${currentUser.nombres} ${currentUser.apellidos}</p>
                        <p><strong>Rol:</strong> ${currentUser.rol}</p>
                        <p><strong>Email:</strong> ${currentUser.correo}</p>
                    `;
                    
                    // Verificar si es admin
                    if (currentUser.rol !== 'admin') {
                        showError('No tienes permisos de administrador');
                        logout();
                    }
                } else {
                    showError('Error en login: ' + result.message);
                }
            } catch (error) {
                showError('Error de conexión: ' + error.message);
            }
        }

        async function loadProducts() {
            if (!userToken) {
                showError('No hay token de autenticación');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/admin/products`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    displayProducts(result.products);
                } else {
                    showError('Error al cargar productos: ' + result.message);
                }
            } catch (error) {
                showError('Error de conexión: ' + error.message);
            }
        }

        async function loadSizes() {
            if (!userToken) {
                showError('No hay token de autenticación');
                return;
            }

            try {
                const response = await fetch(`${API_URL}/sizes`, {
                    headers: {
                        'Authorization': `Bearer ${userToken}`
                    }
                });

                const result = await response.json();
                
                if (result.success) {
                    displaySizes(result.sizes);
                } else {
                    showError('Error al cargar tallas: ' + result.message);
                }
            } catch (error) {
                showError('Error de conexión: ' + error.message);
            }
        }

        function displayProducts(products) {
            const resultsDiv = document.getElementById('results');
            let html = `<h3>Productos (${products.length})</h3>`;
            
            products.slice(0, 5).forEach(product => {
                html += `
                    <div class="product-card">
                        <h4>${product.nombre}</h4>
                        <p><strong>Categoría:</strong> ${product.categoria}</p>
                        <p><strong>Marca:</strong> ${product.marca}</p>
                        <p><strong>Precio:</strong> $${product.precio_minimo} - $${product.precio_maximo}</p>
                        <p><strong>Variantes:</strong> ${product.total_variantes}</p>
                        <p><strong>Stock:</strong> ${product.stock_total}</p>
                        <p><strong>Estado:</strong> ${product.activo ? 'Activo' : 'Inactivo'}</p>
                        ${product.imagen_principal ? `<p><strong>Imagen:</strong> <a href="${product.imagen_principal}" target="_blank">Ver</a></p>` : ''}
                    </div>
                `;
            });
            
            if (products.length > 5) {
                html += `<p>... y ${products.length - 5} productos más</p>`;
            }
            
            resultsDiv.innerHTML = html;
        }

        function displaySizes(sizes) {
            const resultsDiv = document.getElementById('results');
            let html = `<h3>Tallas (${sizes.length})</h3>`;
            
            sizes.forEach(size => {
                html += `<span style="border: 1px solid #ccc; padding: 4px 8px; margin: 2px; display: inline-block; border-radius: 3px;">${size.nombre_talla}</span>`;
            });
            
            resultsDiv.innerHTML = html;
        }

        function showError(message) {
            const errorDiv = document.getElementById('loginError');
            errorDiv.textContent = message;
            errorDiv.classList.remove('hidden');
            setTimeout(() => {
                errorDiv.classList.add('hidden');
            }, 5000);
        }

        function logout() {
            userToken = null;
            currentUser = null;
            document.getElementById('loginForm').classList.remove('hidden');
            document.getElementById('adminPanel').classList.add('hidden');
            document.getElementById('results').innerHTML = '';
        }
    </script>
</body>
</html>
